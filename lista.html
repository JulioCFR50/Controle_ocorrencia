<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta name="description" content="Pagina Relatorio Nota Devolução">
<meta name="author" content="Julio Cesar">
<title>Lista de Devolução</title>
<script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
<style>
* { margin:0; padding:0; box-sizing:border-box; }
html, body {
    height: 100%;
    font-family: Arial, sans-serif;
    background: url("coqueiral.png") no-repeat center center fixed;
    background-size: cover;
    overflow: hidden;
}

/* ===== CONTAINER GERAL ===== */
.container {
    position: fixed;
    top:0; left:0; right:0; bottom:0;
    width:100%; height:100%;
    background: rgba(255,255,255,0.30);
    backdrop-filter: blur(10px);
    padding:15px;
    border-radius:8px;
    box-shadow:0 8px 15px rgba(0,0,0,0.3);
    display:flex;
    flex-direction:column;
    overflow:auto;
}

/* ===== TOPO ===== */
.top-area {
    position: sticky;
    top:0;
    z-index:20;
    background: rgba(255,255,255,0.20);
    backdrop-filter: blur(6px);
    padding:8px 10px;
    border-radius:6px;
    box-shadow:0 1px 4px rgba(0,0,0,0.2);
    margin-bottom:10px;
}

.top-area h1 {
    font-size:1.6rem;
    text-align:center;
    color:#fc0505;
    margin-bottom:8px;
}

.pesquisa-container {
    display:flex;
    justify-content:center;
    gap:6px;
}

button.salvar {
    background:#007bff;
    color:white;
    border:none;
    padding:4px 10px;
    border-radius:4px;
    cursor:pointer;
    font-size:0.8rem;
}

/* ===== LISTA ===== */
#listaInvoices {
    flex:1;
    overflow:auto;
    border:1px solid #ccc;
    border-radius:6px;
    background: rgba(255,255,255,0.40);
    padding:5px;
}

#listaInvoices table {
    width:100%;
    border-collapse:collapse;
    min-width:1200px;
}

#listaInvoices th {
    background: rgba(0, 123, 255, 0.85);
    color:white;
    font-weight:bold;
    position: sticky;
    top:0;
    z-index:3;
    backdrop-filter: blur(6px);
    font-size:0.75rem;
}

#listaInvoices td, #listaInvoices th {
    border:1px solid #ccc;
    font-size:0.70rem;
    padding:4px;
    text-align:center;    
    white-space: nowrap;
}

#listaInvoices tr:nth-child(even) td { background: rgba(240,240,240,0.8); }
#listaInvoices tr:nth-child(odd) td { background: rgba(255,255,255,0.55); }
#listaInvoices tr:hover td { background:#fdf59f !important; cursor:pointer; }

footer {
    margin-top:6px;
    display:flex;
    justify-content:space-between;
    font-size:0.65rem;
    color:#f8f6f6;
    border-top:1px solid #ccc;
}
</style>
</head>
<body>
<div class="container">
    <div class="top-area">
        <h1>Controle Ocorrência</h1>
        <div class="pesquisa-container">
            <a href="index.html">
                <button class="salvar">Voltar</button>
            </a>
        </div>
    </div>

    <div id="listaInvoices">
        <table>
            <thead>
                <tr>
                    <th>Transportadora</th>
                    <th>NF Origem</th>
                    <th>Cliente</th>
                    <th>DT Emissão</th>
                    <th>Dt Entrega</th>
                    <th>NFD</th>
                    <th>Dt Emissão</th>
                    <th>Motivo Devolução</th>
                    <th>Status Atual</th>
                    <th>Ação da devolução</th>
                    <th>Validação</th>
                    <th>Itens da devolução</th>
                    <th>Faturamento Contra</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody id="tabelaInvoices"></tbody>
        </table>
    </div>

    <footer>
        <span>© 2025 Julio Cesar. Todos os direitos reservados.</span>
    </footer>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
    apiKey: "AIzaSyDetNhQe-U_xoBD4o7oytKhj_lyH6PR25M",
    authDomain: "controle-de-ocorrencia-4ffc2.firebaseapp.com",
    projectId: "controle-de-ocorrencia-4ffc2",
    storageBucket: "controle-de-ocorrencia-4ffc2.firebasestorage.app",
    messagingSenderId: "230686446885",
    appId: "1:230686446885:web:3b992cebd2e9024c09f6cc"
};

const app = initializeApp(firebaseConfig);
const db  = getFirestore(app);
const invoicesCol = collection(db, "invoices");

async function carregarInvoices() {
    const tabela = document.getElementById("tabelaInvoices");
    tabela.innerHTML = "";
    const snapshot = await getDocs(invoicesCol);
    snapshot.forEach(docSnap => {
        const data = docSnap.data();

        // Filtra apenas registros com status "Finalizada"
        if(data.status !== "Finalizada") return;

        const tr = document.createElement("tr");

        ["transportadora","nfOrigem","cliente","dtEmissao","dtEntrega","nfd","dtNFDEmissao",
        "motivoDevolucao","statusAtual","acaoDevolucao","validacao","itensDevolucao",
        "faturamentoContra","status"].forEach(campo=>{
            const td = document.createElement("td");
            td.textContent = data[campo] || "";
            tr.appendChild(td);
        });

        // Botão editar que leva ao index
        tr.addEventListener("click", () => {
            localStorage.setItem("nfEditar", docSnap.id);
            window.location.href = "index.html";
        });

        tabela.appendChild(tr);
    });
}

window.addEventListener("load", carregarInvoices);
</script>


</body>
</html>